<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width" />
    <title>語詞測驗</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.0.0/css/bootstrap.min.css" crossorigin="anonymous">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/4.0.0/superhero/bootstrap.css" media="screen">
    <style>
        .hei {
            font-family: 'Noto Sans CJK TC', 'Noto Sans CJK';
            font-size: 10vw;
            padding-left: 6px;
            padding-right: 6px;
        }

        .kai {
            font-family: 'CMEXKai', '教育部標準楷書', '全字庫正楷體', '全字庫正楷體 Plus', '全字庫正楷體 Ext-B';
            font-size: 10vw;
            padding-left: 6px;
            padding-right: 6px;
        }

        .ming {
            font-family: 'CMEXSong', 'CMEXSongUN', '教育部標準宋體', '教育部標準宋體UN', '全字庫正宋體', '全字庫正宋體 Plus', '全字庫正宋體 Ext-B';
            font-size: 10vw;
            padding-left: 6px;
            padding-right: 6px;
        }

        .pic {
            width: 64px;
            padding-left: 6px;
            padding-right: 6px;
        }

        .media {
            margin-top: 8px;
            margin-bottom: 8px;
        }
    </style>
</head>

<body>
    <div class="container">
        <div class="row" id="word">
            <div class="col-xs-4 col-ms-4 col-md-4 col-lg-4">
            </div>
            <div class="col-xs-4 col-ms-4 col-md-4 col-lg-4 text-center text-warning">
                <span id="answer" class="kai"></span>
                <div class="form-group">
                    <input id="guess" type="text" class="text-center form-control kai" placeholder="" size="1" maxlength="1" />
                </div>
            </div>
        </div>
        <div class="row" id="quiz">
            <div class="col-xs-1 col-ms-1 col-md-1 col-lg-1">
            </div>
            <div id="option" class="col-xs-10 col-ms-10 col-md-10 col-lg-10 text-center">
            </div>
        </div>
        <div class="row">
            <div class="col-xs-4 col-ms-4 col-md-4 col-lg-4">
            </div>
            <div class="col-xs-4 col-ms-4 col-md-4 col-lg-4 text-center">
                <button type="button" class="btn btn-default btn-md" id="show">顯示答案</button>
                <button type="button" class="btn btn-success btn-md" id="next">下一題</button>
            </div>
        </div>
    </div>

    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.9/umd/popper.min.js"></script>
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.0.0/js/bootstrap.min.js"></script>
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/tinysort/2.3.6/tinysort.min.js"></script>
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/tinysort/2.3.6/jquery.tinysort.min.js"></script>
    <script type="text/javascript" src="quiz_prefix.js"></script>
    <script type="text/javascript" src="quiz_suffix.js"></script>

    <script type="text/javascript">
        $(document).ready(function() {
            var len = Math.min(quiz_prefix.length, quiz_suffix.length);

            $('#show').on('click', function() {
                var answer = $('#answer').text();
                var guess = $('#guess').val();

                if (answer === guess) {
                    var guess = $('#guess').val(answer).addClass('text-success');
                } else if (answer !== guess) {
                    var guess = $('#guess').val(answer).addClass('text-danger');
                }
            });

            function showQuiz() {
                // randomize quiz
                var j = Math.floor(Math.random() * len);

                // lyshie_20181003: random choose 'prefix' or 'suffix'
                var is_prefix = (Math.random() < 0.5) ? true : false;

                var quiz_str = is_prefix ? quiz_prefix[j] : quiz_suffix[j];
                console.log(quiz_str);

                var quiz = quiz_str.split(' ');

                // randomize quiz options
                quiz.sort(function(a, b) {
                    return Math.random() - 0.5;
                });

                var word = is_prefix ? quiz[0][0] : quiz[0][1];
                var options = quiz.slice(0, 4).map(function(item) {
                    return is_prefix ? item[1] : item[0];
                });

                $('#guess').val('').removeClass('text-danger text-success').focus();
                $('#answer').hide().text(word);

                $('#option').empty();
                $.each(options, function(key, value) {
                    $('#option').append($('<span class="kai">').text(value));
                });

                // lyshie_20181003: swap DOM elements
                if (is_prefix) {
                    $("#quiz").before($("#word"));
                } else {
                    $("#word").before($("#quiz"));
                }

                $('#guess').focus();
            }

            $('#next').on('click', function() {
                showQuiz();
            });

            $('#guess').on('keypress', function(e) {
                if (e.which == 13) {
                    $('#show').trigger('click');
                }
            });

            $('#next').trigger('click');
        });
    </script>
</body>

</html>
